2022-05-31 10:06:24.840667: I tensorflow/core/tpu/tpu_api_dlsym_initializer.cc:116] Libtpu path is: libtpu.so
Missing key: 'TWIST' in 'tpu-env' (yaml) instance metadata.
2022-05-31 10:06:26.542948: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  SSE3 SSE4.1 SSE4.2 AVX AVX2 AVX512F FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2022-05-31 10:06:32.700304: I tensorflow/compiler/xla/service/service.cc:170] XLA service 0x1dd6900 initialized for platform TPU (this does not guarantee that XLA will be used). Devices:
2022-05-31 10:06:32.700375: I tensorflow/compiler/xla/service/service.cc:178]   StreamExecutor device (0): TPU, 2a886c8
2022-05-31 10:06:32.700384: I tensorflow/compiler/xla/service/service.cc:178]   StreamExecutor device (1): TPU, 2a886c8
2022-05-31 10:06:32.700391: I tensorflow/compiler/xla/service/service.cc:178]   StreamExecutor device (2): TPU, 2a886c8
2022-05-31 10:06:32.700397: I tensorflow/compiler/xla/service/service.cc:178]   StreamExecutor device (3): TPU, 2a886c8
2022-05-31 10:06:32.700403: I tensorflow/compiler/xla/service/service.cc:178]   StreamExecutor device (4): TPU, 2a886c8
2022-05-31 10:06:32.700422: I tensorflow/compiler/xla/service/service.cc:178]   StreamExecutor device (5): TPU, 2a886c8
2022-05-31 10:06:32.700428: I tensorflow/compiler/xla/service/service.cc:178]   StreamExecutor device (6): TPU, 2a886c8
2022-05-31 10:06:32.700434: I tensorflow/compiler/xla/service/service.cc:178]   StreamExecutor device (7): TPU, 2a886c8
WARNING:absl:`tf.distribute.experimental.TPUStrategy` is deprecated, please use  the non experimental symbol `tf.distribute.TPUStrategy` instead.
2022-05-31 10:06:41.110052: I tensorflow/compiler/mlir/tensorflow/utils/dump_mlir_util.cc:263] disabling MLIR crash reproducer, set env var `MLIR_CRASH_REPRODUCER_DIRECTORY` to enable.
2022-05-31 10:06:41.133721: I tensorflow/compiler/jit/xla_compilation_cache.cc:478] Compiled cluster using XLA!  This line is logged at most once for the lifetime of the process.
2022-05-31 10:06:41.150297: W tensorflow/compiler/tf2xla/kernels/random_ops.cc:57] Warning: Using tf.random.uniform with XLA compilation will ignore seeds; consider using tf.random.stateless_uniform instead if reproducible behavior is desired. RandomUniform
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 input_1 (InputLayer)           [(None, 550, 6)]     0           []                               
                                                                                                  
 dense (Dense)                  (None, 550, 16)      112         ['input_1[0][0]']                
                                                                                                  
 dense_1 (Dense)                (None, 550, 16)      272         ['dense[0][0]']                  
                                                                                                  
 conv1d (Conv1D)                (None, 550, 64)      3136        ['dense_1[0][0]']                
                                                                                                  
 concatenate (Concatenate)      (None, 550, 80)      0           ['conv1d[0][0]',                 
                                                                  'dense_1[0][0]']                
                                                                                                  
 layer_normalization (LayerNorm  (None, 550, 80)     160         ['concatenate[0][0]']            
 alization)                                                                                       
                                                                                                  
 dense_2 (Dense)                (None, 550, 32)      2592        ['layer_normalization[0][0]']    
                                                                                                  
 conv1d_1 (Conv1D)              (None, 550, 512)     344576      ['dense_2[0][0]']                
                                                                                                  
 concatenate_1 (Concatenate)    (None, 550, 544)     0           ['conv1d_1[0][0]',               
                                                                  'dense_2[0][0]']                
                                                                                                  
 layer_normalization_1 (LayerNo  (None, 550, 544)    1088        ['concatenate_1[0][0]']          
 rmalization)                                                                                     
                                                                                                  
 dense_3 (Dense)                (None, 550, 512)     279040      ['layer_normalization_1[0][0]']  
                                                                                                  
 dense_4 (Dense)                (None, 550, 256)     131328      ['dense_3[0][0]']                
                                                                                                  
 conv1d_2 (Conv1D)              (None, 550, 1024)    5506048     ['dense_4[0][0]']                
                                                                                                  
 concatenate_2 (Concatenate)    (None, 550, 1280)    0           ['conv1d_2[0][0]',               
                                                                  'dense_4[0][0]']                
                                                                                                  
 layer_normalization_2 (LayerNo  (None, 550, 1280)   2560        ['concatenate_2[0][0]']          
 rmalization)                                                                                     
                                                                                                  
 dense_5 (Dense)                (None, 550, 512)     655872      ['layer_normalization_2[0][0]']  
                                                                                                  
 dense_6 (Dense)                (None, 550, 256)     131328      ['dense_5[0][0]']                
                                                                                                  
 input_2 (InputLayer)           [(None, 2)]          0           []                               
                                                                                                  
 lstm (LSTM)                    (None, 256)          525312      ['dense_6[0][0]']                
                                                                                                  
 concatenate_3 (Concatenate)    (None, 258)          0           ['input_2[0][0]',                
                                                                  'lstm[0][0]']                   
                                                                                                  
 dense_7 (Dense)                (None, 512)          132608      ['concatenate_3[0][0]']          
                                                                                                  
 leaky_re_lu (LeakyReLU)        (None, 512)          0           ['dense_7[0][0]']                
                                                                                                  
 dense_8 (Dense)                (None, 512)          262656      ['leaky_re_lu[0][0]']            
                                                                                                  
 leaky_re_lu_1 (LeakyReLU)      (None, 512)          0           ['dense_8[0][0]']                
                                                                                                  
 dense_9 (Dense)                (None, 512)          262656      ['leaky_re_lu_1[0][0]']          
                                                                                                  
 leaky_re_lu_2 (LeakyReLU)      (None, 512)          0           ['dense_9[0][0]']                
                                                                                                  
 dense_10 (Dense)               (None, 3)            1536        ['leaky_re_lu_2[0][0]']          
                                                                                                  
==================================================================================================
Total params: 8,242,880
Trainable params: 8,242,880
Non-trainable params: 0
__________________________________________________________________________________________________
warmup...
Traceback (most recent call last):
  File "lstm1.py", line 538, in <module>
    agent.train(num_steps = n, envs = envs, warmup = n, log_interval = n, train_steps_per_step=1)
  File "lstm1.py", line 343, in train
    states = [x.reset(True) for x in envs]
  File "lstm1.py", line 343, in <listcomp>
    states = [x.reset(True) for x in envs]
  File "lstm1.py", line 134, in reset
    return self._next_observation()
  File "lstm1.py", line 109, in _next_observation
    inference_data = sample_to_x(candles)
NameError: name 'sample_to_x' is not defined
2022-05-31 10:08:08.605649: I tensorflow/core/tpu/tpu_api_dlsym_initializer.cc:116] Libtpu path is: libtpu.so
Missing key: 'TWIST' in 'tpu-env' (yaml) instance metadata.
2022-05-31 10:08:10.286381: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  SSE3 SSE4.1 SSE4.2 AVX AVX2 AVX512F FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2022-05-31 10:08:25.024439: I tensorflow/compiler/xla/service/service.cc:170] XLA service 0x3204900 initialized for platform TPU (this does not guarantee that XLA will be used). Devices:
2022-05-31 10:08:25.024497: I tensorflow/compiler/xla/service/service.cc:178]   StreamExecutor device (0): TPU, 2a886c8
2022-05-31 10:08:25.024507: I tensorflow/compiler/xla/service/service.cc:178]   StreamExecutor device (1): TPU, 2a886c8
2022-05-31 10:08:25.024513: I tensorflow/compiler/xla/service/service.cc:178]   StreamExecutor device (2): TPU, 2a886c8
2022-05-31 10:08:25.024520: I tensorflow/compiler/xla/service/service.cc:178]   StreamExecutor device (3): TPU, 2a886c8
2022-05-31 10:08:25.024526: I tensorflow/compiler/xla/service/service.cc:178]   StreamExecutor device (4): TPU, 2a886c8
2022-05-31 10:08:25.024532: I tensorflow/compiler/xla/service/service.cc:178]   StreamExecutor device (5): TPU, 2a886c8
2022-05-31 10:08:25.024539: I tensorflow/compiler/xla/service/service.cc:178]   StreamExecutor device (6): TPU, 2a886c8
2022-05-31 10:08:25.024545: I tensorflow/compiler/xla/service/service.cc:178]   StreamExecutor device (7): TPU, 2a886c8
WARNING:absl:`tf.distribute.experimental.TPUStrategy` is deprecated, please use  the non experimental symbol `tf.distribute.TPUStrategy` instead.
2022-05-31 10:08:45.589492: I tensorflow/compiler/mlir/tensorflow/utils/dump_mlir_util.cc:263] disabling MLIR crash reproducer, set env var `MLIR_CRASH_REPRODUCER_DIRECTORY` to enable.
2022-05-31 10:08:45.613230: I tensorflow/compiler/jit/xla_compilation_cache.cc:478] Compiled cluster using XLA!  This line is logged at most once for the lifetime of the process.
2022-05-31 10:08:45.637405: W tensorflow/compiler/tf2xla/kernels/random_ops.cc:57] Warning: Using tf.random.uniform with XLA compilation will ignore seeds; consider using tf.random.stateless_uniform instead if reproducible behavior is desired. RandomUniform
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 input_1 (InputLayer)           [(None, 550, 6)]     0           []                               
                                                                                                  
 dense (Dense)                  (None, 550, 16)      112         ['input_1[0][0]']                
                                                                                                  
 dense_1 (Dense)                (None, 550, 16)      272         ['dense[0][0]']                  
                                                                                                  
 conv1d (Conv1D)                (None, 550, 64)      3136        ['dense_1[0][0]']                
                                                                                                  
 concatenate (Concatenate)      (None, 550, 80)      0           ['conv1d[0][0]',                 
                                                                  'dense_1[0][0]']                
                                                                                                  
 layer_normalization (LayerNorm  (None, 550, 80)     160         ['concatenate[0][0]']            
 alization)                                                                                       
                                                                                                  
 dense_2 (Dense)                (None, 550, 32)      2592        ['layer_normalization[0][0]']    
                                                                                                  
 conv1d_1 (Conv1D)              (None, 550, 512)     344576      ['dense_2[0][0]']                
                                                                                                  
 concatenate_1 (Concatenate)    (None, 550, 544)     0           ['conv1d_1[0][0]',               
                                                                  'dense_2[0][0]']                
                                                                                                  
 layer_normalization_1 (LayerNo  (None, 550, 544)    1088        ['concatenate_1[0][0]']          
 rmalization)                                                                                     
                                                                                                  
 dense_3 (Dense)                (None, 550, 512)     279040      ['layer_normalization_1[0][0]']  
                                                                                                  
 dense_4 (Dense)                (None, 550, 256)     131328      ['dense_3[0][0]']                
                                                                                                  
 conv1d_2 (Conv1D)              (None, 550, 1024)    5506048     ['dense_4[0][0]']                
                                                                                                  
 concatenate_2 (Concatenate)    (None, 550, 1280)    0           ['conv1d_2[0][0]',               
                                                                  'dense_4[0][0]']                
                                                                                                  
 layer_normalization_2 (LayerNo  (None, 550, 1280)   2560        ['concatenate_2[0][0]']          
 rmalization)                                                                                     
                                                                                                  
 dense_5 (Dense)                (None, 550, 512)     655872      ['layer_normalization_2[0][0]']  
                                                                                                  
 dense_6 (Dense)                (None, 550, 256)     131328      ['dense_5[0][0]']                
                                                                                                  
 input_2 (InputLayer)           [(None, 2)]          0           []                               
                                                                                                  
 lstm (LSTM)                    (None, 256)          525312      ['dense_6[0][0]']                
                                                                                                  
 concatenate_3 (Concatenate)    (None, 258)          0           ['input_2[0][0]',                
                                                                  'lstm[0][0]']                   
                                                                                                  
 dense_7 (Dense)                (None, 512)          132608      ['concatenate_3[0][0]']          
                                                                                                  
 leaky_re_lu (LeakyReLU)        (None, 512)          0           ['dense_7[0][0]']                
                                                                                                  
 dense_8 (Dense)                (None, 512)          262656      ['leaky_re_lu[0][0]']            
                                                                                                  
 leaky_re_lu_1 (LeakyReLU)      (None, 512)          0           ['dense_8[0][0]']                
                                                                                                  
 dense_9 (Dense)                (None, 512)          262656      ['leaky_re_lu_1[0][0]']          
                                                                                                  
 leaky_re_lu_2 (LeakyReLU)      (None, 512)          0           ['dense_9[0][0]']                
                                                                                                  
 dense_10 (Dense)               (None, 3)            1536        ['leaky_re_lu_2[0][0]']          
                                                                                                  
==================================================================================================
Total params: 8,242,880
Trainable params: 8,242,880
Non-trainable params: 0
__________________________________________________________________________________________________
